(()=>{"use strict";var t=function(){},e=function(){function t(){this.cookieName="habitzen.data"}return t.prototype.load=function(){var t=this.getCookie();return console.log("Loaded Value: "+t),JSON.parse(t)},t.prototype.save=function(t){var e=JSON.stringify(t);this.setCookie(e),console.log("DataStoreCookie: save")},t.prototype.setCookie=function(t){document.cookie=this.cookieName+"="+t+";SameSite=Strict;Secure; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"},t.prototype.getCookie=function(){var t=("; "+document.cookie).split("; "+this.cookieName+"=");if(2==t.length)return t.pop().split(";").shift()},t}(),i=function(){function t(){this.dataStore=new e,this.load()}return Object.defineProperty(t.prototype,"list",{get:function(){return this.data},enumerable:!1,configurable:!0}),t.prototype.load=function(){var t=this.dataStore.load();this.data=t},t.prototype.delete=function(t){for(var e=this.list.length-1;e>=0;--e)this.list[e].id==t&&this.list.splice(e,1);this.saveAll()},t.prototype.get=function(t){var e=null;return this.list.forEach((function(i){i.id==t&&(e=i)})),e},t.prototype.save=function(t){t.id?this.modify(t):this.create(t)},t.prototype.saveAll=function(){this.dataStore.save(this.data)},t.prototype.create=function(t){t.id=crypto.randomUUID(),this.list.push(t),this.saveAll()},t.prototype.modify=function(t){this.list.forEach((function(e){e.id==t.id&&(e.name=t.name)})),this.saveAll()},t.prototype.complete=function(t){this.list.forEach((function(e){e.id==t&&(e.timestamp=(new Date).getTime())})),this.saveAll()},t}(),o=function(){function e(){this.habits=new i}return e.prototype.refreshHabits=function(){var t=this,e=document.getElementById("habit-list");this.clear(e.id);var i=new Date;this.habits.list.forEach((function(o){var n=!1;if(o.timestamp){var s=new Date(o.timestamp);n=t.isSameDay(s,i)}var a=document.createElement("div");a.className=n?"habit-item complete":"habit-item";var h=t.escapeHtml(o.name);a.onclick=function(){t.complete(o.id)},a.innerHTML="<span>"+h+"</span>",e.appendChild(a)}))},e.prototype.isSameDay=function(t,e){return null!=t&&null!=e&&t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},e.prototype.complete=function(t){confirm("Complete this habit for today?")&&(this.habits.complete(t),this.refreshHabits())},e.prototype.save=function(){var e=new t,i=document.getElementById("edit");e.id=i.dataset.id,e.name=document.getElementById("txt-edit-name").value,this.habits.save(e),this.showMain()},e.prototype.delete=function(){if(confirm("Delete this habit?")){var t=document.getElementById("edit").dataset.id;this.habits.delete(t),this.showMain()}},e.prototype.showNew=function(){document.getElementById("edit-title").innerText="Create New Habit",document.getElementById("edit").dataset.id="",document.getElementById("txt-edit-name").value="",this.hideAllSections(),this.show("edit"),this.hide("btn-options"),this.show("btn-back"),this.hide("btn-edit-delete")},e.prototype.showEdit=function(t){document.getElementById("edit-title").innerText="Edit Habit",document.getElementById("edit").dataset.id=t;var e=this.habits.get(t);document.getElementById("txt-edit-name").value=e.name,this.hideAllSections(),this.show("edit"),this.hide("btn-options"),this.show("btn-back"),this.show("btn-edit-delete")},e.prototype.showOptions=function(){this.hideAllSections(),this.show("options"),this.hide("btn-options"),this.show("btn-back");var t=this,e=document.getElementById("edit-list");this.clear(e.id),this.habits.list.forEach((function(i){var o=t.escapeHtml(i.name),n=document.createElement("div");n.innerHTML="<button type='button' class='btn btn-edit' onclick='habitzen.edit(\""+i.id+"\")'>âœŽ&nbsp;"+o+"</button>",e.appendChild(n)}))},e.prototype.escapeHtml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e.prototype.showMain=function(){this.hideAllSections(),this.show("main"),this.refreshHabits(),this.hide("btn-back"),this.show("btn-options")},e.prototype.hideAllSections=function(){document.querySelectorAll(".section").forEach((function(t){t.style.display="none"}))},e.prototype.show=function(t){document.getElementById(t).style.display="block"},e.prototype.hide=function(t){document.getElementById(t).style.display="none"},e.prototype.clear=function(t){document.getElementById(t).textContent=""},e}(),n=function(){function t(){this.page=new o;var t=this;document.addEventListener("DOMContentLoaded",(function(){t.page.showMain()}))}return t.prototype.main=function(){this.page.showMain()},t.prototype.options=function(){this.page.showOptions()},t.prototype.new=function(){this.page.showNew()},t.prototype.edit=function(t){this.page.showEdit(t)},t.prototype.delete=function(t){this.page.delete()},t.prototype.save=function(){this.page.save()},t}();window.habitzen=window.habitzen||{},window.habitzen=new n})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGdCQUFSLFdBQ3FCNUQsU0FBU29FLGlCQUE4QixZQUMvQ2pELFNBQVEsU0FBVWtELEdBQ3ZCQSxFQUFRQyxNQUFNQyxRQUFVLE1BQzVCLEdBQ0osRUFFUSxZQUFBVixLQUFSLFNBQWFqRCxHQUNUWixTQUFTbUMsZUFBZXZCLEdBQUkwRCxNQUFNQyxRQUFVLE9BQ2hELEVBRVEsWUFBQVQsS0FBUixTQUFhbEQsR0FDVFosU0FBU21DLGVBQWV2QixHQUFJMEQsTUFBTUMsUUFBVSxNQUNoRCxFQUVRLFlBQUFuQyxNQUFSLFNBQWN4QixHQUNNWixTQUFTbUMsZUFBZXZCLEdBQ2hDNEQsWUFBYyxFQUMxQixFQUVKLEVBbkpBLEdDREEsYUFHRSxhQUZRLEtBQUFDLEtBQWEsSUFBSUMsRUFHdkIsSUFBTXpDLEVBQU81QyxLQUViVyxTQUFTMkUsaUJBQWlCLG9CQUFvQixXQUM1QzFDLEVBQUt3QyxLQUFLaEIsVUFDWixHQUNGLENBeUJGLE9BdkJFLFlBQUFtQixLQUFBLFdBQ0V2RixLQUFLb0YsS0FBS2hCLFVBQ1osRUFFQSxZQUFBb0IsUUFBQSxXQUNFeEYsS0FBS29GLEtBQUtULGFBQ1osRUFFQSxZQUFBYyxJQUFBLFdBQ0V6RixLQUFLb0YsS0FBS2YsU0FDWixFQUVBLFlBQUFxQixLQUFBLFNBQUtuRSxHQUNIdkIsS0FBS29GLEtBQUtWLFNBQVNuRCxFQUNyQixFQUVBLFlBQUFELE9BQUEsU0FBT0MsR0FDTHZCLEtBQUtvRixLQUFLOUQsUUFDWixFQUVBLFlBQUFoQixLQUFBLFdBQ0VOLEtBQUtvRixLQUFLOUUsTUFDWixFQUNGLEVBbENBLEdBd0NBcUYsT0FBT0MsU0FBV0QsT0FBT0MsVUFBWSxDQUFDLEVBQ3RDRCxPQUFPQyxTQUFXLElBQUlDLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oYWJpdHplbi8uL3NyYy9oYWJpdC50cyIsIndlYnBhY2s6Ly9oYWJpdHplbi8uL3NyYy9kYXRhU3RvcmVDb29raWUudHMiLCJ3ZWJwYWNrOi8vaGFiaXR6ZW4vLi9zcmMvaGFiaXRzLnRzIiwid2VicGFjazovL2hhYml0emVuLy4vc3JjL3BhZ2UudHMiLCJ3ZWJwYWNrOi8vaGFiaXR6ZW4vLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIEhhYml0IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IG51bWJlcjtcbn0iLCJpbXBvcnQgeyBEYXRhU3RvcmUgfSBmcm9tIFwiLi9kYXRhU3RvcmVcIlxuaW1wb3J0IHsgSGFiaXQgfSBmcm9tIFwiLi9oYWJpdFwiXG5cbmV4cG9ydCBjbGFzcyBIYWJpdERhdGFDb29raWUgaW1wbGVtZW50cyBEYXRhU3RvcmUge1xuXG4gICAgLy9yZWFkb25seSBjb29raWVOYW1lOiBzdHJpbmcgPSBcImRhdGFcIjtcbiAgICByZWFkb25seSBjb29raWVOYW1lOiBzdHJpbmcgPSBcImhhYml0emVuLmRhdGFcIjtcblxuICAgIGxvYWQoKTogQXJyYXk8SGFiaXQ+IHtcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5nZXRDb29raWUoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJMb2FkZWQgVmFsdWU6IFwiICsgdmFsdWUpXG4gICAgICAgIGxldCBpdGVtcyA9IEpTT04ucGFyc2UodmFsdWUpXG4gICAgICAgIHJldHVybiBpdGVtcztcbiAgICB9XG5cbiAgICBzYXZlKGhhYml0RGF0YTogQXJyYXk8SGFiaXQ+KTogdm9pZCB7XG4gICAgICAgIGxldCBqc29uID0gSlNPTi5zdHJpbmdpZnkoaGFiaXREYXRhKTtcbiAgICAgICAgdGhpcy5zZXRDb29raWUoanNvbik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRGF0YVN0b3JlQ29va2llOiBzYXZlXCIpXG4gICAgfVxuXG5cbiAgICBwcml2YXRlIHNldENvb2tpZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IHRoaXMuY29va2llTmFtZSArIFwiPVwiICsgdmFsdWUgKyBcIjtTYW1lU2l0ZT1TdHJpY3Q7U2VjdXJlOyBleHBpcmVzPUZyaSwgMzEgRGVjIDk5OTkgMjM6NTk6NTkgR01UOyBwYXRoPS9cIjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENvb2tpZSgpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBcIjsgXCIgKyBkb2N1bWVudC5jb29raWU7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gdmFsdWUuc3BsaXQoXCI7IFwiICsgdGhpcy5jb29raWVOYW1lICsgXCI9XCIpO1xuXG4gICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnRzLnBvcCgpLnNwbGl0KFwiO1wiKS5zaGlmdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG59IiwiaW1wb3J0IHsgSGFiaXQgfSBmcm9tIFwiLi9oYWJpdFwiO1xuaW1wb3J0IHsgSGFiaXREYXRhQ29va2llIH0gZnJvbSBcIi4vZGF0YVN0b3JlQ29va2llXCI7XG5pbXBvcnQgeyBEYXRhU3RvcmUgfSBmcm9tIFwiLi9kYXRhU3RvcmVcIjtcblxuXG5leHBvcnQgY2xhc3MgSGFiaXRzIHtcblxuICAgIGRhdGFTdG9yZTogRGF0YVN0b3JlO1xuICAgIGRhdGE6IEFycmF5PEhhYml0PjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRhdGFTdG9yZSA9IG5ldyBIYWJpdERhdGFDb29raWUoKTtcbiAgICAgICAgdGhpcy5sb2FkKCk7XG4gICAgfVxuXG4gICAgZ2V0IGxpc3QoKTogQXJyYXk8SGFiaXQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWQoKTogdm9pZCB7XG4gICAgICAgIGxldCBpdGVtcyA9IHRoaXMuZGF0YVN0b3JlLmxvYWQoKTtcbiAgICAgICAgdGhpcy5kYXRhID0gaXRlbXM7XG4gICAgfVxuXG4gICAgZGVsZXRlKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGlzdC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgaWYgKHRoaXMubGlzdFtpXS5pZCA9PSBpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdC5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNhdmVBbGwoKTtcbiAgICB9XG5cbiAgICBnZXQoaWQ6IHN0cmluZyk6IEhhYml0IHtcblxuICAgICAgICBsZXQgaGFiaXQgPSBudWxsO1xuXG4gICAgICAgIHRoaXMubGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgaGFiaXQgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGhhYml0O1xuICAgIH1cblxuICAgIHNhdmUoaGFiaXQ6IEhhYml0KTogdm9pZCB7XG4gICAgICAgIGlmIChoYWJpdC5pZCkge1xuICAgICAgICAgICAgdGhpcy5tb2RpZnkoaGFiaXQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGUoaGFiaXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzYXZlQWxsKCkge1xuICAgICAgICB0aGlzLmRhdGFTdG9yZS5zYXZlKHRoaXMuZGF0YSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGUoaGFiaXQ6IEhhYml0KSB7XG4gICAgICAgIGhhYml0LmlkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICAgICAgdGhpcy5saXN0LnB1c2goaGFiaXQpO1xuICAgICAgICB0aGlzLnNhdmVBbGwoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG1vZGlmeShoYWJpdDogSGFiaXQpIHtcbiAgICAgICAgdGhpcy5saXN0LmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUuaWQgPT0gaGFiaXQuaWQpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5uYW1lID0gaGFiaXQubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zYXZlQWxsKCk7XG4gICAgfVxuXG4gICAgY29tcGxldGUoaWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLmxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaGFiaXQpIHtcbiAgICAgICAgICAgIGlmIChoYWJpdC5pZCA9PSBpZCkge1xuICAgICAgICAgICAgICAgIGhhYml0LnRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnNhdmVBbGwoKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgSGFiaXQgfSBmcm9tIFwiLi9oYWJpdFwiO1xuaW1wb3J0IHsgSGFiaXRzIH0gZnJvbSBcIi4vaGFiaXRzXCI7XG5cbmV4cG9ydCBjbGFzcyBQYWdlIHtcblxuICAgIGhhYml0czogSGFiaXRzID0gbmV3IEhhYml0cygpO1xuXG4gICAgcmVmcmVzaEhhYml0cygpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBkaXZIYWJpdExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFiaXQtbGlzdCcpO1xuICAgICAgICB0aGlzLmNsZWFyKGRpdkhhYml0TGlzdC5pZCk7XG5cbiAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIHRoaXMuaGFiaXRzLmxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaGFiaXQpIHtcbiAgICAgICAgICAgIGxldCBpc0NvbXBsZXRlID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChoYWJpdC50aW1lc3RhbXApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0Q29tcGxldGVkID0gbmV3IERhdGUoaGFiaXQudGltZXN0YW1wKTtcbiAgICAgICAgICAgICAgICBpc0NvbXBsZXRlID0gc2VsZi5pc1NhbWVEYXkobGFzdENvbXBsZXRlZCwgdG9kYXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAgICAgICAgIGlmIChpc0NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBcImhhYml0LWl0ZW0gY29tcGxldGVcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBcImhhYml0LWl0ZW1cIlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gc2VsZi5lc2NhcGVIdG1sKGhhYml0Lm5hbWUpO1xuICAgICAgICAgICAgZWxlbWVudC5vbmNsaWNrID0gZnVuY3Rpb24gKCkgeyBzZWxmLmNvbXBsZXRlKGhhYml0LmlkKTsgfTtcbiAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gXCI8c3Bhbj5cIiArIG5hbWUgKyBcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgIGRpdkhhYml0TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1NhbWVEYXkoYTogRGF0ZSwgYjogRGF0ZSkge1xuICAgICAgICBpZiAoYSA9PSBudWxsIHx8IGIgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGEuZ2V0RnVsbFllYXIoKSA9PT0gYi5nZXRGdWxsWWVhcigpICYmIGEuZ2V0TW9udGgoKSA9PT0gYi5nZXRNb250aCgpICYmIGEuZ2V0RGF0ZSgpID09PSBiLmdldERhdGUoKTtcbiAgICB9XG5cbiAgICBjb21wbGV0ZShpZDogc3RyaW5nKSB7XG4gICAgICAgIGlmIChjb25maXJtKFwiQ29tcGxldGUgdGhpcyBoYWJpdCBmb3IgdG9kYXk/XCIpKSB7XG4gICAgICAgICAgICB0aGlzLmhhYml0cy5jb21wbGV0ZShpZCk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hIYWJpdHMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNhdmUoKSB7XG4gICAgICAgIGNvbnN0IGhhYml0ID0gbmV3IEhhYml0KCk7XG4gICAgICAgIGNvbnN0IGRpdkVkaXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVkaXRcIik7XG4gICAgICAgIGhhYml0LmlkID0gZGl2RWRpdC5kYXRhc2V0LmlkO1xuICAgICAgICBoYWJpdC5uYW1lID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHh0LWVkaXQtbmFtZVwiKSkudmFsdWU7XG4gICAgICAgIHRoaXMuaGFiaXRzLnNhdmUoaGFiaXQpO1xuICAgICAgICB0aGlzLnNob3dNYWluKCk7XG4gICAgfVxuXG4gICAgZGVsZXRlKCkge1xuICAgICAgICBpZiAoY29uZmlybShcIkRlbGV0ZSB0aGlzIGhhYml0P1wiKSkge1xuICAgICAgICAgICAgY29uc3QgZGl2RWRpdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdFwiKTtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gZGl2RWRpdC5kYXRhc2V0LmlkO1xuICAgICAgICAgICAgdGhpcy5oYWJpdHMuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIHRoaXMuc2hvd01haW4oKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3dOZXcoKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdC10aXRsZVwiKS5pbm5lclRleHQgPSBcIkNyZWF0ZSBOZXcgSGFiaXRcIjtcbiAgICAgICAgY29uc3QgZGl2RWRpdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdFwiKTtcbiAgICAgICAgZGl2RWRpdC5kYXRhc2V0LmlkID0gXCJcIjtcbiAgICAgICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHh0LWVkaXQtbmFtZVwiKSkudmFsdWUgPSBcIlwiO1xuICAgICAgICB0aGlzLmhpZGVBbGxTZWN0aW9ucygpO1xuICAgICAgICB0aGlzLnNob3coXCJlZGl0XCIpO1xuICAgICAgICB0aGlzLmhpZGUoXCJidG4tb3B0aW9uc1wiKTtcbiAgICAgICAgdGhpcy5zaG93KFwiYnRuLWJhY2tcIik7XG4gICAgICAgIHRoaXMuaGlkZShcImJ0bi1lZGl0LWRlbGV0ZVwiKTtcbiAgICB9XG5cbiAgICBzaG93RWRpdChpZDogc3RyaW5nKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdC10aXRsZVwiKS5pbm5lclRleHQgPSBcIkVkaXQgSGFiaXRcIjtcbiAgICAgICAgY29uc3QgZGl2RWRpdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdFwiKTtcbiAgICAgICAgZGl2RWRpdC5kYXRhc2V0LmlkID0gaWQ7XG4gICAgICAgIGxldCBoYWJpdCA9IHRoaXMuaGFiaXRzLmdldChpZCk7XG4gICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInR4dC1lZGl0LW5hbWVcIikpLnZhbHVlID0gaGFiaXQubmFtZTtcbiAgICAgICAgdGhpcy5oaWRlQWxsU2VjdGlvbnMoKTtcbiAgICAgICAgdGhpcy5zaG93KFwiZWRpdFwiKTtcbiAgICAgICAgdGhpcy5oaWRlKFwiYnRuLW9wdGlvbnNcIik7XG4gICAgICAgIHRoaXMuc2hvdyhcImJ0bi1iYWNrXCIpO1xuICAgICAgICB0aGlzLnNob3coXCJidG4tZWRpdC1kZWxldGVcIik7XG4gICAgfVxuXG4gICAgc2hvd09wdGlvbnMoKSB7XG4gICAgICAgIHRoaXMuaGlkZUFsbFNlY3Rpb25zKCk7XG4gICAgICAgIHRoaXMuc2hvdyhcIm9wdGlvbnNcIik7XG4gICAgICAgIHRoaXMuaGlkZShcImJ0bi1vcHRpb25zXCIpO1xuICAgICAgICB0aGlzLnNob3coXCJidG4tYmFja1wiKTtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBkaXZFZGl0TGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWxpc3QnKTtcbiAgICAgICAgdGhpcy5jbGVhcihkaXZFZGl0TGlzdC5pZCk7XG5cbiAgICAgICAgdGhpcy5oYWJpdHMubGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChoYWJpdCkge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IHNlbGYuZXNjYXBlSHRtbChoYWJpdC5uYW1lKTtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gXCI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J2J0biBidG4tZWRpdCcgb25jbGljaz0naGFiaXR6ZW4uZWRpdChcXFwiXCIgKyBoYWJpdC5pZCArIFwiXFxcIiknPuKcjiZuYnNwO1wiICsgbmFtZSArIFwiPC9idXR0b24+XCI7XG4gICAgICAgICAgICBkaXZFZGl0TGlzdC5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZXNjYXBlSHRtbCh1bnNhZmU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdW5zYWZlXG4gICAgICAgICAgICAucmVwbGFjZSgvJi9nLCBcIiZhbXA7XCIpXG4gICAgICAgICAgICAucmVwbGFjZSgvPC9nLCBcIiZsdDtcIilcbiAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpXG4gICAgICAgICAgICAucmVwbGFjZSgvJy9nLCBcIiYjMDM5O1wiKTtcbiAgICB9XG5cbiAgICBzaG93TWFpbigpIHtcbiAgICAgICAgdGhpcy5oaWRlQWxsU2VjdGlvbnMoKTtcbiAgICAgICAgdGhpcy5zaG93KFwibWFpblwiKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoSGFiaXRzKCk7XG4gICAgICAgIHRoaXMuaGlkZShcImJ0bi1iYWNrXCIpO1xuICAgICAgICB0aGlzLnNob3coXCJidG4tb3B0aW9uc1wiKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhpZGVBbGxTZWN0aW9ucygpIHtcbiAgICAgICAgY29uc3Qgc2VjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignLnNlY3Rpb24nKTtcbiAgICAgICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoc2VjdGlvbikge1xuICAgICAgICAgICAgc2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3coaWQ6IHN0cmluZykge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoaWRlKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhcihpZDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG4gICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSAnJztcbiAgICB9XG5cbn0iLCJpbXBvcnQgeyBQYWdlIH0gZnJvbSAnLi9wYWdlJztcblxuY2xhc3MgSGFiaXR6ZW4ge1xuICBwcml2YXRlIHBhZ2U6IFBhZ2UgPSBuZXcgUGFnZSgpO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5wYWdlLnNob3dNYWluKCk7XG4gICAgfSk7XG4gIH1cblxuICBtYWluKCkge1xuICAgIHRoaXMucGFnZS5zaG93TWFpbigpO1xuICB9XG5cbiAgb3B0aW9ucygpIHtcbiAgICB0aGlzLnBhZ2Uuc2hvd09wdGlvbnMoKTtcbiAgfVxuXG4gIG5ldygpIHtcbiAgICB0aGlzLnBhZ2Uuc2hvd05ldygpO1xuICB9XG5cbiAgZWRpdChpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5wYWdlLnNob3dFZGl0KGlkKTtcbiAgfVxuXG4gIGRlbGV0ZShpZDogc3RyaW5nKSB7XG4gICAgdGhpcy5wYWdlLmRlbGV0ZSgpO1xuICB9XG5cbiAgc2F2ZSgpIHtcbiAgICB0aGlzLnBhZ2Uuc2F2ZSgpO1xuICB9XG59XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7IGhhYml0emVuOiBhbnk7IH1cbn1cblxud2luZG93LmhhYml0emVuID0gd2luZG93LmhhYml0emVuIHx8IHt9O1xud2luZG93LmhhYml0emVuID0gbmV3IEhhYml0emVuKCk7Il0sIm5hbWVzIjpbImNvb2tpZU5hbWUiLCJsb2FkIiwidmFsdWUiLCJ0aGlzIiwiZ2V0Q29va2llIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJwYXJzZSIsInNhdmUiLCJoYWJpdERhdGEiLCJqc29uIiwic3RyaW5naWZ5Iiwic2V0Q29va2llIiwiZG9jdW1lbnQiLCJjb29raWUiLCJwYXJ0cyIsInNwbGl0IiwibGVuZ3RoIiwicG9wIiwic2hpZnQiLCJkYXRhU3RvcmUiLCJIYWJpdERhdGFDb29raWUiLCJkYXRhIiwiaXRlbXMiLCJkZWxldGUiLCJpZCIsImkiLCJsaXN0Iiwic3BsaWNlIiwic2F2ZUFsbCIsImdldCIsImhhYml0IiwiZm9yRWFjaCIsIm1vZGlmeSIsImNyZWF0ZSIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJwdXNoIiwibmFtZSIsImNvbXBsZXRlIiwidGltZXN0YW1wIiwiRGF0ZSIsImdldFRpbWUiLCJoYWJpdHMiLCJIYWJpdHMiLCJyZWZyZXNoSGFiaXRzIiwic2VsZiIsImRpdkhhYml0TGlzdCIsImdldEVsZW1lbnRCeUlkIiwiY2xlYXIiLCJ0b2RheSIsImlzQ29tcGxldGUiLCJsYXN0Q29tcGxldGVkIiwiaXNTYW1lRGF5IiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJlc2NhcGVIdG1sIiwib25jbGljayIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiYSIsImIiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImNvbmZpcm0iLCJIYWJpdCIsImRpdkVkaXQiLCJkYXRhc2V0Iiwic2hvd01haW4iLCJzaG93TmV3IiwiaW5uZXJUZXh0IiwiaGlkZUFsbFNlY3Rpb25zIiwic2hvdyIsImhpZGUiLCJzaG93RWRpdCIsInNob3dPcHRpb25zIiwiZGl2RWRpdExpc3QiLCJ1bnNhZmUiLCJyZXBsYWNlIiwicXVlcnlTZWxlY3RvckFsbCIsInNlY3Rpb24iLCJzdHlsZSIsImRpc3BsYXkiLCJ0ZXh0Q29udGVudCIsInBhZ2UiLCJQYWdlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1haW4iLCJvcHRpb25zIiwibmV3IiwiZWRpdCIsIndpbmRvdyIsImhhYml0emVuIiwiSGFiaXR6ZW4iXSwic291cmNlUm9vdCI6IiJ9